<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hapag Hub | Filipino Recipes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <a href="index.html" class="logo">Hapag Hub</a>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search recipes...">
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
            <span id="userDisplay" style="color:white; font-size:14px; margin-right:10px;"></span>
            <a href="add-recipe.html" class="add-custom-btn">Add New Recipe</a>
            <button id="logoutBtn" class="delete-recipe-btn" style="width:auto; padding:10px 15px; margin:0;">Logout</button>
        </div>
    </header>

    <div class="container">
        <div id="recipeGrid" class="recipe-grid"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDL8NMWIDSp2uZ95XYfD4VVeExNg6Gk5QY",
            authDomain: "login-example-79848.firebaseapp.com",
            projectId: "login-example-79848",
            storageBucket: "login-example-79848.firebasestorage.app",
            messagingSenderId: "1096469675828",
            appId: "1:1096469675828:web:5b7c18612516d5bf50af61"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.replace('login.html');
            } else {
                document.getElementById('userDisplay').innerText = user.email;
                loadRecipes();
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => window.location.replace('login.html'));
        });

        async function loadRecipes() {
            const grid = document.getElementById('recipeGrid');
            grid.innerHTML = '';
            try {
                const querySnapshot = await getDocs(collection(db, "recipes"));
                querySnapshot.forEach((doc) => {
                    const recipe = doc.data();
                    createCard(recipe.title, recipe.image || "https://via.placeholder.com/300x200?text=No+Image");
                });
            } catch (error) {
                console.error("Error loading recipes:", error);
            }
        }

        function createCard(title, imgSrc) {
            const grid = document.getElementById('recipeGrid');
            const card = document.createElement('div');
            card.className = 'recipe-card';
            card.setAttribute('data-name', title);
            const encodedTitle = encodeURIComponent(title);
            
            card.innerHTML = `
                <div class="image-wrapper"><img src="${imgSrc}" alt="${title}"></div>
                <div class="card-content">
                    <h3>${title}</h3>
                    <div class="button-container">
                        <a href="add-recipe.html?name=${encodedTitle}" class="check-recipe-btn">Edit Recipe</a>
                        <a href="add-recipe.html?name=${encodedTitle}" class="view-recipe-btn" style="text-decoration:none; text-align:center; display:block;">View Recipe</a>
                    </div>
                </div>
            `;
            grid.appendChild(card);
            addDeleteButton(card, title);
        }

        function addDeleteButton(container, title) {
            const delBtn = document.createElement('button');
            delBtn.className = 'delete-recipe-btn';
            delBtn.innerText = 'Delete';
            delBtn.onclick = async () => {
                if (confirm(`Delete recipe for "${title}"?`)) {
                    await deleteDoc(doc(db, "recipes", title));
                    container.remove();
                }
            };
            container.querySelector('.button-container').appendChild(delBtn);
        }

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                document.querySelectorAll('.recipe-card').forEach(card => {
                    const name = card.getAttribute('data-name').toLowerCase();
                    card.style.display = name.includes(term) ? "" : "none";
                });
            });
        }
    </script>
</body>
</html>